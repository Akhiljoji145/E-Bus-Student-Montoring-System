{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Student Dashboard - BusTracker Pro</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="{% static 'common_scripts.js' %}"></script>
    <script>
    function logout() {
    localStorage.removeItem('currentUserRole'); // Clear stored role
    window.location.href = '{% url "student:logout" %}'; // Redirect to login page
    }
    </script>
</head>
<body class="bg-gradient-to-br from-purple-50 to-pink-100 min-h-screen">

    <script>loadDashboardNav();</script>
    <nav class="bg-white shadow-lg">
            <div class="max-w-7xl mx-auto px-4">
                <div class="flex justify-between items-center py-4">
                    <div class="flex items-center space-x-4">
                        <div class="text-2xl font-bold text-indigo-600">üöå BusTracker Pro</div>
                    </div>
                    <div class="flex space-x-4">
                        <button onclick="window.location.href='index.html'" class="px-4 py-2 text-gray-600 hover:text-indigo-600 transition-colors">Home</button>
                        <button id="logoutBtn" onclick="logout()" class="px-4 py-2 text-red-600 hover:text-red-700 transition-colors">Logout</button>
                    </div>
                </div>
            </div>
    </nav>
    <div id="student-dashboard-section" class="section active">
        <div class="max-w-7xl mx-auto py-8 px-4">
            <div class="bg-white rounded-lg shadow-lg p-6 mb-6">
                <h1 class="text-3xl font-bold text-gray-900 mb-2">Student Dashboard</h1>
                <p class="text-gray-600">Manage your bus schedule and submit feedback</p>
            </div>

            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
                <!-- Bus Registration for Hostelers -->
                <div class="bg-white rounded-lg shadow-lg p-6">
                    <h3 class="text-xl font-semibold mb-4">üöå Bus Registration (Hostelers)</h3>
                    <form onsubmit="registerBus(event)" class="space-y-4">
                        <div>
                            <label for="rideType" class="block text-sm font-medium mb-2">Ride Type</label>
                            <select id="rideType" class="w-full p-2 border rounded-md" onchange="toggleMorningStops()">
                                <option value="morning">Morning (Hostel to Campus)</option>
                                <option value="evening">Evening (Campus to Hostel)</option>
                            </select>
                        </div>
                        <div id="morningStops" class="space-y-4">
                            <div>
                                <label for="morningPickupStop" class="block text-sm font-medium mb-2">Morning Pickup Stop</label>
                                <select id="morningPickupStop" class="w-full p-2 border rounded-md">
                                    <option>Hostel Gate A</option>
                                    <option>Hostel Gate B</option>
                                    <option>Hostel Main Road</option>
                                </select>
                            </div>
                            <div>
                                <label for="morningDropoffStop" class="block text-sm font-medium mb-2">Morning Drop-off Stop</label>
                                <select id="morningDropoffStop" class="w-full p-2 border rounded-md">
                                    <option>Campus Main Gate</option>
                                    <option>Campus Admin Block</option>
                                    <option>Campus Library</option>
                                </select>
                            </div>
                        </div>
                        <div id="eveningStops" class="space-y-4 hidden">
                            <div>
                                <label for="eveningPickupStop" class="block text-sm font-medium mb-2">Evening Pickup Stop</label>
                                <select id="eveningPickupStop" class="w-full p-2 border rounded-md">
                                    <option>Campus Main Gate</option>
                                    <option>Campus Admin Block</option>
                                    <option>Campus Library</option>
                                </select>
                            </div>
                            <div>
                                <label for="eveningDropoffStop" class="block text-sm font-medium mb-2">Evening Drop-off Stop</label>
                                <select id="eveningDropoffStop" class="w-full p-2 border rounded-md">
                                    <option>Hostel Gate A</option>
                                    <option>Hostel Gate B</option>
                                    <option>Hostel Main Road</option>
                                </select>
                            </div>
                        </div>
                        <div>
                            <label for="preferredBus" class="block text-sm font-medium mb-2">Preferred Bus (Optional)</label>
                            <select id="preferredBus" class="w-full p-2 border rounded-md">
                                <option value="">Any Available Bus</option>
                                <option>Bus #1 - Route A</option>
                                <option>Bus #2 - Route B</option>
                                <option>Bus #3 - Route C</option>
                            </select>
                        </div>
                        <button type="submit" class="w-full bg-purple-600 text-white py-2 px-4 rounded-md hover:bg-purple-700">
                            Register for Bus
                        </button>
                    </form>
                </div>

                <!-- Submit Complaints -->
                <div class="bg-white rounded-lg shadow-lg p-6">
                    <h3 class="text-xl font-semibold mb-4">üìù Submit a Complaint</h3>
                    <form onsubmit="submitComplaint(event)" class="space-y-4">
                        <div>
                            <label for="complaintSubject" class="block text-sm font-medium mb-2">Subject</label>
                            <input type="text" id="complaintSubject" required class="w-full p-2 border rounded-md" placeholder="e.g., Bus Delay, Driver Behavior">
                        </div>
                        <div>
                            <label for="complaintBusRoute" class="block text-sm font-medium mb-2">Related Bus/Route (Optional)</label>
                            <select id="complaintBusRoute" class="w-full p-2 border rounded-md">
                                <option value="">Not Applicable</option>
                                <option>Bus #1 - Route A</option>
                                <option>Bus #2 - Route B</option>
                                <option>Bus #3 - Route C</option>
                                <option>Bus #4 - Route D</option>
                            </select>
                        </div>
                        <div>
                            <label for="complaintDetails" class="block text-sm font-medium mb-2">Details of Complaint</label>
                            <textarea id="complaintDetails" rows="5" required class="w-full p-2 border rounded-md" placeholder="Please provide as much detail as possible..."></textarea>
                        </div>
                        <button type="submit" class="w-full bg-red-600 text-white py-2 px-4 rounded-md hover:bg-red-700">
                            Submit Complaint
                        </button>
                    </form>
                </div>

                <!-- View Action Taken on Complaints -->
                <div class="bg-white rounded-lg shadow-lg p-6 col-span-1 lg:col-span-2">
                    <h3 class="text-xl font-semibold mb-4">‚úÖ Action Taken on Your Complaints</h3>
                    <div id="complaintActionList" class="space-y-4">
                        <!-- Complaints and actions will be dynamically loaded here -->
                        <div class="p-4 bg-blue-50 border border-blue-200 rounded-lg">
                            <h4 class="font-medium text-blue-800 mb-1">Subject: Bus #2 - Overcrowding</h4>
                            <p class="text-sm text-blue-700 mb-2">Complaint: "Bus is always too full in the evenings, hard to find a seat."</p>
                            <p class="text-xs text-gray-600">Submitted: 2023-10-26</p>
                            <div class="mt-2 p-3 bg-blue-100 border border-blue-300 rounded-md">
                                <p class="font-semibold text-blue-900">Action Taken:</p>
                                <p class="text-sm text-blue-800">"Acknowledged. An additional bus (Bus #5) has been assigned to Route B during peak evening hours starting next week to alleviate overcrowding. Please provide feedback on the new arrangement."</p>
                                <p class="text-xs text-gray-700 mt-1">Status: Resolved - 2023-10-28</p>
                            </div>
                        </div>
                        <div class="p-4 bg-yellow-50 border border-yellow-200 rounded-lg">
                            <h4 class="font-medium text-yellow-800 mb-1">Subject: Driver Behavior - Bus #4</h4>
                            <p class="text-sm text-yellow-700 mb-2">Complaint: "Driver was speeding and talking on phone during ride."</p>
                            <p class="text-xs text-gray-600">Submitted: 2023-10-20</p>
                            <div class="mt-2 p-3 bg-yellow-100 border border-yellow-300 rounded-md">
                                <p class="font-semibold text-yellow-900">Action Taken:</p>
                                <p class="text-sm text-yellow-800">"Complaint received. Driver has been counseled regarding safe driving practices and use of mobile devices. Monitoring will be increased."</p>
                                <p class="text-xs text-gray-700 mt-1">Status: In Progress - 2023-10-22</p>
                            </div>
                        </div>
                        <div class="p-4 bg-gray-50 border border-gray-200 rounded-lg">
                            <h4 class="font-medium text-gray-800 mb-1">Subject: Late Bus - Morning Route A</h4>
                            <p class="text-sm text-gray-700 mb-2">Complaint: "Bus #1 was 20 minutes late this morning."</p>
                            <p class="text-xs text-gray-600">Submitted: 2023-10-15</p>
                            <div class="mt-2 p-3 bg-gray-100 border border-gray-300 rounded-md">
                                <p class="font-semibold text-gray-900">Action Taken:</p>
                                <p class="text-sm text-gray-800">"Investigated. Delay was due to unexpected road construction. Route timing adjusted for future. Apologies for inconvenience."</p>
                                <p class="text-xs text-gray-700 mt-1">Status: Resolved - 2023-10-17</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Student Dashboard Functions
        function toggleMorningStops() {
            const rideType = document.getElementById('rideType').value;
            const morningStopsDiv = document.getElementById('morningStops');
            const eveningStopsDiv = document.getElementById('eveningStops');

            if (rideType === 'morning') {
                morningStopsDiv.classList.remove('hidden');
                eveningStopsDiv.classList.add('hidden');
            } else {
                morningStopsDiv.classList.add('hidden');
                eveningStopsDiv.classList.remove('hidden');
            }
        }

        function registerBus(event) {
            event.preventDefault();
            const rideType = document.getElementById('rideType').value;
            let pickupStop, dropoffStop;

            if (rideType === 'morning') {
                pickupStop = document.getElementById('morningPickupStop').value;
                dropoffStop = document.getElementById('morningDropoffStop').value;
            } else {
                pickupStop = document.getElementById('eveningPickupStop').value;
                dropoffStop = document.getElementById('eveningDropoffStop').value;
            }
            const preferredBus = document.getElementById('preferredBus').value;

            alert(`Bus Registration Confirmed!\nRide Type: ${rideType.charAt(0).toUpperCase() + rideType.slice(1)}\nPickup Stop: ${pickupStop}\nDrop-off Stop: ${dropoffStop}\nPreferred Bus: ${preferredBus || 'Any'}\n\nYour registration has been submitted.`);
            
            // In a real application, this would send data to your backend to register the student.
            // Clear form (optional, depending on desired user flow)
            // document.getElementById('rideType').value = 'morning';
            // toggleMorningStops(); // Reset visibility
            // document.getElementById('preferredBus').value = '';
        }

        function submitComplaint(event) {
            event.preventDefault();
            const subject = document.getElementById('complaintSubject').value;
            const busRoute = document.getElementById('complaintBusRoute').value;
            const details = document.getElementById('complaintDetails').value;

            alert(`Complaint Submitted!\nSubject: ${subject}\nBus/Route: ${busRoute || 'N/A'}\nDetails: ${details}\n\nThank you for your feedback. We will review your complaint shortly.`);
            
            // In a real application, this would send the complaint data to your backend.
            // Clear form
            document.getElementById('complaintSubject').value = '';
            document.getElementById('complaintBusRoute').value = '';
            document.getElementById('complaintDetails').value = '';
        }

        // Function to simulate loading complaints and their actions (from backend)
        function loadComplaintActions() {
            const complaintsData = [
                {
                    subject: 'Bus #2 - Overcrowding',
                    complaint: 'Bus is always too full in the evenings, hard to find a seat.',
                    submitted: '2023-10-26',
                    action: 'Acknowledged. An additional bus (Bus #5) has been assigned to Route B during peak evening hours starting next week to alleviate overcrowding. Please provide feedback on the new arrangement.',
                    status: 'Resolved',
                    actionDate: '2023-10-28',
                    type: 'resolved'
                },
                {
                    subject: 'Driver Behavior - Bus #4',
                    complaint: 'Driver was speeding and talking on phone during ride.',
                    submitted: '2023-10-20',
                    action: 'Complaint received. Driver has been counseled regarding safe driving practices and use of mobile devices. Monitoring will be increased.',
                    status: 'In Progress',
                    actionDate: '2023-10-22',
                    type: 'in-progress'
                },
                {
                    subject: 'Late Bus - Morning Route A',
                    complaint: 'Bus #1 was 20 minutes late this morning.',
                    submitted: '2023-10-15',
                    action: 'Investigated. Delay was due to unexpected road construction. Route timing adjusted for future. Apologies for inconvenience.',
                    status: 'Resolved',
                    actionDate: '2023-10-17',
                    type: 'resolved'
                },
                {
                    subject: 'AC not working on Bus #3',
                    complaint: 'The air conditioning on Bus #3 is not working, it gets very hot.',
                    submitted: '2023-11-01',
                    action: 'Maintenance request submitted for Bus #3 AC repair. Expected to be fixed by end of week.',
                    status: 'Pending',
                    actionDate: '2023-11-02',
                    type: 'pending'
                }
            ];

            const complaintActionList = document.getElementById('complaintActionList');
            complaintActionList.innerHTML = ''; // Clear existing list

            complaintsData.forEach(complaint => {
                const complaintDiv = document.createElement('div');
                let bgColor, borderColor, textColor, actionBgColor, actionBorderColor, actionTextColor;

                if (complaint.type === 'resolved') {
                    bgColor = 'bg-blue-50';
                    borderColor = 'border-blue-200';
                    textColor = 'text-blue-800';
                    actionBgColor = 'bg-blue-100';
                    actionBorderColor = 'border-blue-300';
                    actionTextColor = 'text-blue-900';
                } else if (complaint.type === 'in-progress') {
                    bgColor = 'bg-yellow-50';
                    borderColor = 'border-yellow-200';
                    textColor = 'text-yellow-800';
                    actionBgColor = 'bg-yellow-100';
                    actionBorderColor = 'border-yellow-300';
                    actionTextColor = 'text-yellow-900';
                } else { // pending or other
                    bgColor = 'bg-gray-50';
                    borderColor = 'border-gray-200';
                    textColor = 'text-gray-800';
                    actionBgColor = 'bg-gray-100';
                    actionBorderColor = 'border-gray-300';
                    actionTextColor = 'text-gray-900';
                }

                complaintDiv.className = `p-4 ${bgColor} ${borderColor} rounded-lg`;
                complaintDiv.innerHTML = `
                    <h4 class="font-medium ${textColor} mb-1">Subject: ${complaint.subject}</h4>
                    <p class="text-sm ${textColor} mb-2">Complaint: "${complaint.complaint}"</p>
                    <p class="text-xs text-gray-600">Submitted: ${complaint.submitted}</p>
                    <div class="mt-2 p-3 ${actionBgColor} ${actionBorderColor} rounded-md">
                        <p class="font-semibold ${actionTextColor}">Action Taken:</p>
                        <p class="text-sm ${actionTextColor}">${complaint.action}</p>
                        <p class="text-xs text-gray-700 mt-1">Status: ${complaint.status} - ${complaint.actionDate}</p>
                    </div>
                `;
                complaintActionList.appendChild(complaintDiv);
            });
        }

        // Load complaints when the page loads (simulated)
        document.addEventListener('DOMContentLoaded', () => {
            toggleMorningStops(); // Set initial state for bus registration
            loadComplaintActions();
        });
    </script>
</body>
</html>
